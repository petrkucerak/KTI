import csv
import pandas as pd
path = 'nmap-09/09.txt'
path_csv= 'nmap-09/09.csv'
txt = open(path,'r')
r = csv.reader(open(path_csv))
w = csv.writer(open("nmap-09/res.csv",'w'))
data= pd.read_csv(path_csv)
txt_l_arr = []
for l in txt:
    txt_l_arr.append(l)
for rl in r:
    time =""
    Alert = ""
    if(rl[0]!= "@timestamp"):
        time = rl[0].split()[4]
        print(time)
        for l in txt_l_arr:
            if time in l:
                arr= l.split()
                star_cnt=0
                stop_idx=0
                for i in range(len(arr)):
                    if(arr[i]=='[**]'):
                        star_cnt=star_cnt+1
                        if(star_cnt==2):
                            stop_idx=i
                for i in range(stop_idx):
                    if(i>2):
                        Alert+=arr[i]+" "
                print(Alert)
                w.writerow((rl[0],rl[3],rl[4],rl[5],rl[6],Alert))
                Alert=""
                txt_l_arr.remove(l)

"""
file_txt = open(path,'r')
file_csv = open(path_csv)
r= csv.reader(file_csv)
row0= next(r)
row0.append('Alert name')
print(row0)

lines = file_txt.readlines()
dataLines= []
for l in lines:
    if "SURICATA STREAM Packet with invalid timestamp" not in l:
        dataLines.append(l)
"""